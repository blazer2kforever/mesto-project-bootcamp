(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e){e.classList.add("popup_opened"),e.addEventListener("click",r),document.addEventListener("keydown",o)}function n(){var e=document.querySelector(".popup_opened");e.classList.remove("popup_opened"),e.removeEventListener("click",r),document.removeEventListener("keydown",o)}function o(e){"Escape"===e.key&&n()}function r(e){(e.target===e.currentTarget||e.target.classList.contains("popup__close-button"))&&n()}e.d({},{Z:()=>G});var c={formSelector:".popup__form",inputSelector:".popup__input",inputInvalidSelector:"popup__input_invalid",errorVisibleSelector:"popup__input-error_visible",buttonSelector:".popup__save-button",buttonDisabledSelector:"popup__save-button_disabled"},u={url:"https://nomoreparties.co/v1/wbf-cohort-11",headers:{authorization:"b4d4e0d1-d19b-4b35-891c-88f5710bd461","Content-Type":"application/json"}};function a(e,t,n){var o={method:"".concat(t),headers:u.headers,body:JSON.stringify(n)};return fetch(e,o).then(l)}function l(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function i(e,t){return a("".concat(u.url,"/cards/likes/").concat(e.cardId),t)}var s=document.querySelector(".gallery__list"),p=document.querySelector("#card").content.querySelector(".gallery__item"),d=document.querySelector(".popup__view-image"),_=d.querySelector(".popup__image"),f=d.querySelector(".popup__description"),v=[];function m(e){var n=p.cloneNode(!0),o=n.querySelector(".gallery__title"),r=n.querySelector(".gallery__image"),c=n.querySelector(".gallery__like-button"),l=n.querySelector(".gallery__likes-count"),s=n.querySelector(".gallery__trash-button");return o.textContent=e.place,r.src=e.link,r.alt=e.place,l.textContent=e.likes.length,e.likes.forEach((function(e){e===G&&c.classList.add("gallery__like-button_checked")})),r.addEventListener("click",(function(){t(d),function(e,t){_.src=t,_.alt=e,f.textContent=e}(e.place,e.link)})),c.addEventListener("click",(function(){!function(e,t,n){t.classList.contains("gallery__like-button_checked")?i(e,"DELETE").then((function(e){n.textContent=Number(e.likes.length),t.classList.remove("gallery__like-button_checked")})).catch((function(e){alert(e)})):i(e,"PUT").then((function(e){n.textContent=Number(e.likes.length),t.classList.add("gallery__like-button_checked")})).catch((function(e){alert(e)}))}(e,c,l)})),G===e.ownerId&&(s.classList.add("gallery__trash-button_visible"),s.addEventListener("click",(function(){!function(e,t){a("".concat(u.url,"/cards/").concat(e.cardId),"DELETE",{name:e.name,link:e.link}).then((function(){t.remove()})).catch((function(e){alert(e)}))}(e,n)}))),n}function y(e){return{place:e.name,link:e.link,cardId:e._id,ownerId:e.owner._id,likes:e.likes.map((function(e){return e._id}))}}function S(e,t,n){var o=e.querySelector("#".concat(t.id,"-error"));o.textContent="",o.classList.remove(n.errorVisibleSelector),t.classList.remove(n.inputInvalidSelector)}function b(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=Array.from(e.querySelectorAll(t.buttonSelector));n.forEach((function(n){S(e,n,t)})),o.forEach((function(e){e.setAttribute("disabled",!0),e.classList.add(t.buttonDisabledSelector)}))}var h,q=document.querySelector(".profile__name"),k=document.querySelector(".profile__subheading"),L=document.querySelector(".profile__avatar-button"),E=document.querySelector(".popup__edit-avatar"),g=document.querySelector(".popup__input-avatar"),C=document.querySelector(".profile__avatar"),x=document.querySelector(".profile__edit-button"),A=document.querySelector(".popup__edit-profile"),T=document.querySelector(".popup__input-username"),w=document.querySelector(".popup__input-userstatus"),I=document.querySelector(".profile__add-button"),D=document.querySelector(".popup__add-image"),P=document.querySelector(".popup__input-place"),j=document.querySelector(".popup__input-link"),O=document.querySelector(".popup__form-avatar"),N=document.querySelector(".popup__form-profile"),V=document.querySelector(".popup__form-image"),G=null,H=null;function z(e,t){e.textContent=t}function J(){T.value=q.textContent,w.value=k.textContent}function M(e){e.reset()}L.addEventListener("click",(function(){t(E),M(O),b(O,c)})),x.addEventListener("click",(function(){t(A),J(),b(N,c)})),I.addEventListener("click",(function(){t(D),M(V),b(V,c)})),O.addEventListener("submit",(function(){var e;z(O.querySelector(".popup__save-button"),"Сохранение..."),(e=g.value,a("".concat(u.url,"/users/me/avatar"),"PATCH",{avatar:e})).then((function(){C.src=g.value,n()})).catch((function(e){alert(e)})).finally((function(){z(O.querySelector(".popup__save-button"),"Сохранить")}))})),N.addEventListener("submit",(function(){var e,t;z(N.querySelector(".popup__save-button"),"Сохранение..."),(e=T.value,t=w.value,a("".concat(u.url,"/users/me"),"PATCH",{name:e,about:t})).then((function(){q.textContent=T.value,k.textContent=w.value,n()})).catch((function(e){alert(e)})).finally((function(){z(N.querySelector(".popup__save-button"),"Cохранить")}))})),V.addEventListener("submit",(function(){var e,t;z(V.querySelector(".popup__save-button"),"Сохранение..."),(e=P.value,t=j.value,function(e){return a("".concat(u.url,"/cards"),"POST",{name:e.name,link:e.link})}({name:e,link:t}).then((function(e){var t=y(e);v.push(t),s.prepend(m(t))})).catch((function(e){alert(e)}))).then((function(){n()})).catch((function(e){alert(e)})).finally((function(){z(V.querySelector(".popup__save-button"),"Cохранить")}))})),a("".concat(u.url,"/users/me"),"GET").then((function(e){H=e,G=e._id,q.textContent=e.name,k.textContent=e.about,a("".concat(u.url,"/cards"),"GET").then((function(e){(v=e.map((function(e){return y(e)}))).forEach((function(e){s.append(m(e))}))})).catch((function(e){alert(e)})),C.src=H.avatar})).catch((function(e){alert(e)})),J(),h=c,document.querySelectorAll(h.formSelector).forEach((function(e){!function(e,t){e.addEventListener("submit",(function(e){e.preventDefault()}));var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.buttonSelector);n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?S(e,t,n):function(e,t,n){var o=e.querySelector("#".concat(t.id,"-error"));o.textContent=t.validationMessage,o.classList.add(n.errorVisibleSelector),t.classList.add(n.inputInvalidSelector)}(e,t,n)}(e,r,t),function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?(e.removeAttribute("disabled"),e.classList.remove(n.buttonDisabledSelector)):(e.setAttribute("disabled",!0),e.classList.add(n.buttonDisabledSelector))}(o,n,t)}))}))}(e,h)}))})();