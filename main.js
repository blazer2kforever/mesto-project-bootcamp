(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e){e.classList.add("popup_opened"),e.addEventListener("click",r),document.addEventListener("keydown",o)}function n(){var e=document.querySelector(".popup_opened");e.classList.remove("popup_opened"),e.removeEventListener("click",r),document.removeEventListener("keydown",o)}function o(e){"Escape"===e.key&&n()}function r(e){(e.target===e.currentTarget||e.target.classList.contains("popup__close-button"))&&n()}e.d({},{Z:()=>G});var u={formSelector:".popup__form",inputSelector:".popup__input",inputInvalidSelector:"popup__input_invalid",errorVisibleSelector:"popup__input-error_visible",buttonSelector:".popup__save-button",buttonDisabledSelector:"popup__save-button_disabled"},c={url:"https://nomoreparties.co/v1/wbf-cohort-11",headers:{authorization:"b4d4e0d1-d19b-4b35-891c-88f5710bd461","Content-Type":"application/json"}};function i(e,t,n){var o={method:"".concat(t),headers:c.headers,body:JSON.stringify(n)};return fetch(e,o).then(l)}function l(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function a(e,t){return i("".concat(c.url,"/cards/likes/").concat(e.cardId),t)}var p=document.querySelector(".gallery__list"),d=document.querySelector("#card").content.querySelector(".gallery__item"),s=document.querySelector(".popup__view-image"),_=s.querySelector(".popup__image"),v=s.querySelector(".popup__description"),f=[];function m(e){var n=d.cloneNode(!0),o=n.querySelector(".gallery__title"),r=n.querySelector(".gallery__image"),u=n.querySelector(".gallery__like-button"),l=n.querySelector(".gallery__likes-count"),p=n.querySelector(".gallery__trash-button");return o.textContent=e.place,r.src=e.link,r.alt=e.place,l.textContent=e.likes.length,e.likes.forEach((function(e){e===G&&u.classList.add("gallery__like-button_checked")})),r.addEventListener("click",(function(){t(s),function(e,t){_.src=t,_.alt=e,v.textContent=e}(e.place,e.link)})),u.addEventListener("click",(function(){!function(e,t,n){e.likes.some((function(e){return e===G}))?(a(e,"DELETE").then((function(e){n.textContent=Number(e.likes.length)})),t.classList.remove("gallery__like-button_checked")):(a(e,"PUT").then((function(e){n.textContent=Number(e.likes.length)})),t.classList.add("gallery__like-button_checked"))}(e,u,l)})),G===e.ownerId&&(p.classList.add("gallery__trash-button_visible"),p.addEventListener("click",(function(){n.remove(),function(e){i("".concat(c.url,"/cards/").concat(e.cardId),"DELETE",{name:e.name,link:e.link})}(e)}))),n}function y(e){return{place:e.name,link:e.link,cardId:e._id,ownerId:e.owner._id,likes:e.likes.map((function(e){return e._id}))}}function S(e,t,n){var o=e.querySelector("#".concat(t.id,"-error"));o.textContent="",o.classList.remove(n.errorVisibleSelector),t.classList.remove(n.inputInvalidSelector)}function b(e,t){Array.from(e.querySelectorAll(t.inputSelector)).forEach((function(n){S(e,n,t)}))}var q,k=document.querySelector(".profile__name"),h=document.querySelector(".profile__subheading"),L=document.querySelector(".profile__avatar-button"),E=document.querySelector(".popup__edit-avatar"),g=document.querySelector(".popup__input-avatar"),C=document.querySelector(".profile__avatar"),x=document.querySelector(".profile__edit-button"),T=document.querySelector(".popup__edit-profile"),A=document.querySelector(".popup__input-username"),w=document.querySelector(".popup__input-userstatus"),I=document.querySelector(".profile__add-button"),P=document.querySelector(".popup__add-image"),D=document.querySelector(".popup__input-place"),j=document.querySelector(".popup__input-link"),O=document.querySelector(".popup__form-avatar"),N=document.querySelector(".popup__form-profile"),V=document.querySelector(".popup__form-image"),G=null,H=null;function z(e,t){e.textContent=t}function J(){A.value=k.textContent,w.value=h.textContent}function M(e){e.reset()}L.addEventListener("click",(function(){t(E),M(O)})),x.addEventListener("click",(function(){t(T),J(),b(N,u)})),I.addEventListener("click",(function(){t(P),M(V),b(V,u)})),O.addEventListener("submit",(function(){var e;z(O.querySelector(".popup__save-button"),"Сохранение..."),C.src=g.value,e=g.value,i("".concat(c.url,"/users/me/avatar"),"PATCH",{avatar:e}),n(),z(O.querySelector(".popup__save-button"),"Сохранить")})),N.addEventListener("submit",(function(){var e,t;z(N.querySelector(".popup__save-button"),"Сохранение..."),k.textContent=A.value,h.textContent=w.value,(e=A.value,t=w.value,i("".concat(c.url,"/users/me"),"PATCH",{name:e,about:t})).then((function(){n(),z(N.querySelector(".popup__save-button"),"Cохранить")}))})),V.addEventListener("submit",(function(){var e,t;z(V.querySelector(".popup__save-button"),"Сохранение..."),e=D.value,t=j.value,function(e){return i("".concat(c.url,"/cards"),"POST",{name:e.name,link:e.link})}({name:e,link:t}).then((function(e){var t=y(e);f.push(t),p.prepend(m(t))})),n(),z(V.querySelector(".popup__save-button"),"Cохранить")})),i("".concat(c.url,"/users/me"),"GET").then((function(e){H=e,G=e._id,k.textContent=e.name,h.textContent=e.about,i("".concat(c.url,"/cards"),"GET").then((function(e){(f=e.map((function(e){return y(e)}))).forEach((function(e){p.append(m(e))}))})),C.src=H.avatar})),J(),q=u,document.querySelectorAll(q.formSelector).forEach((function(e){!function(e,t){e.addEventListener("submit",(function(e){e.preventDefault()}));var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.buttonSelector);n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?S(e,t,n):function(e,t,n){var o=e.querySelector("#".concat(t.id,"-error"));o.textContent=t.validationMessage,o.classList.add(n.errorVisibleSelector),t.classList.add(n.inputInvalidSelector)}(e,t,n)}(e,r,t),function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?(e.removeAttribute("disabled"),e.classList.remove(n.buttonDisabledSelector)):(e.setAttribute("disabled",!0),e.classList.add(n.buttonDisabledSelector))}(o,n,t)}))}))}(e,q)}))})();